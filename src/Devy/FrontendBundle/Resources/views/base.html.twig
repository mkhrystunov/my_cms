<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8"/>
  <title>
    {%- if block('title') -%}
      {{ block('title') }} | UkrBook
    {% else %}
      UkrBook
    {% endif %}
  </title>
  {% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/devyukrbook/css/main.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/devyukrbook/css/bootstrap.css') }}">
  {% endblock %}

  <link rel="icon" type="image/x-icon" href="{{ asset('favicon.ico') }}"/>
</head>
<body>

{% block menu %}
  <div class="navbar-wrapper">
    <div class="container">
      <nav class="navbar navbar-inverse navbar-static-top">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ url('home') }}">Ukr Book</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            {#<ul class="nav navbar-nav">#}
            {#{% for category in categories %}#}
            {#&#123;&#35; TODO paths &#35;&#125;#}
            {#{% if category.activeNotEmptyChildren|length > 0 %}#}
            {#<li class="dropdown">#}
            {#<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">#}
            {#{{ category.title }}#}
            {#<span class="caret"></span>#}
            {#</a>#}
            {#<ul class="dropdown-menu" role="menu">#}
            {#{% for child in category.activeNotEmptyChildren %}#}
            {#<li><a href="#">{{ child.title }}</a></li>#}
            {#{% endfor %}#}
            {#</ul>#}
            {#</li>#}
            {#{% else %}#}
            {#<li><a href="#">{{ category.title }}</a></li>#}
            {#{% endif %}#}
            {#{% endfor %}#}
            {#</ul>#}
            <ul class="nav navbar-nav">
              <li class="{{ active == 'home' ? 'active' }}"><a href="{{ url('home') }}">Home</a></li>
              {% if categories|length > 0 %}
                <li class="dropdown {{ active == 'categories' ? 'active' }}">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                    Categories
                    <i class="caret"></i>
                    <ul class="dropdown-menu" role="menu">
                      {% for category in categories %}
                        <li><a href="{{ path('front_category', { 'categoryId': category.id }) }}">{{ category.title }}</a></li>
                      {% endfor %}
                    </ul>
                  </a>
                </li>
              {% endif %}
              <li><a href="#">About</a></li>
              <li><a href="#">Contact</a></li>
              <li>
                <a href="#">
                  <i class="glyphicon glyphicon-shopping-cart"></i>
                  Cart
                </a>
              </li>
            </ul>

            {# TODO search #}
            <form class="navbar-form navbar-right" role="search">
              <div class="form-group">
                <input type="text" class="form-control" placeholder="Find product">
              </div>
              <button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
            </form>
          </div>
        </div>
      </nav>
    </div>
  </div>
{% endblock %}

{% block upper %}{% endblock %}
{% block body %}{% endblock %}
<footer class="footer container">
  <hr>
  {% block footer %}
    <div class="row">
      <div class="col-md-4">
        <h3>Contact</h3>
        <ul class="list-unstyled">
          <li>
            <i class="glyphicon glyphicon-globe"></i>
            {{ shopinfo.address }}
          </li>
          <li>
            <i class="glyphicon glyphicon-phone"></i>
            <a href="tel:{{ shopinfo.phone }}">{{ shopinfo.phone }}</a>
          </li>
          <li>
            <i class="glyphicon glyphicon-envelope"></i>
            <a href="mailto:{{ shopinfo.email }}">{{ shopinfo.email }}</a>
          </li>
        </ul>
      </div>
      <div class="col-md-4">
        <h3>Useful links</h3>
        <ul>
          {# TODO add links, and more items #}
          <li><a href="#">Cart</a></li>
          <li><a href="#">Checkout</a></li>
        </ul>
      </div>
      <div class="col-md-4">
        <h3>Newsletter</h3>
        {# TODO links, yeap again #}
        {{ form_start(subscribe_form, {'attr': {'class': 'form-inline', 'id': 'subscribe_form'}}) }}
        {{ form_widget(subscribe_form.email) }}
        <button type="submit" class="btn btn-primary">Subscribe</button>
        {{ form_end(subscribe_form) }}
      </div>
    </div>
  {% endblock %}
  <hr>
  <span class="text-muted">Created by <a href="http://khrystunov.com">Maksym Krhystunov</a></span>
  <span class="text-muted pull-right">
    <a href="http://www.facebook.com/khrystunov">Facebook</a>
    <span>|</span>
    <a href="http://www.linkedin.com/in/khrystunov">LinkedIn</a>
  </span>
</footer>

{% block javascripts %}
  <script src="{{ asset('bundles/devyukrbook/js/jquery.js') }}"></script>
  <script src="{{ asset('bundles/devyukrbook/js/bootstrap.js') }}"></script>
  <script>
    var addAlertToForm = function ($form, alertType, msg) {
      var $alert = $('<div>')
              .addClass('alert')
              .addClass(alertType)
              .text(msg)
              .hide();
      $form.prepend($alert);
      $alert.show(1000);
    };

    jQuery(document).ready(function () {
      var $form = $('#subscribe_form');
      $form.on('submit', function (e) {
        var url = $(this).attr('action');
        $form.children('.alert').hide(500, function () {
          $(this).remove();
        });
        $.ajax({
          type: "POST",
          url: url,
          data: $(this).serialize(),
          dataType: "html",
          success: function (msg) {
            msg = $.parseJSON(msg);
            addAlertToForm($form, msg.success ? 'alert-success' : 'alert-warning', msg.message);
            $form.children('input[type=email]').text('');
          },
          error: function (msg) {
            addAlertToForm($form, 'alert-danger', msg.responseText);
          }
        });

        e.preventDefault();
      });
    });
  </script>
{% endblock %}
</body>
</html>
